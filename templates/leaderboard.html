<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Race Leaderboard</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

    body {
      background: transparent;
      color: white;
      overflow: hidden;
      -webkit-user-select: none; /* Safari */
      -moz-user-select: none;    /* Firefox */
      -ms-user-select: none;     /* Internet Explorer/Edge */
      user-select: none;         /* Standar modern */
    
    }

    .hud {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 350px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 12px;
      padding: 10px;
    }

    .logo-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .logo-row img {
      height: 75px;
    }

    .session-label {
      font-size: 40px;
      margin-right: 20px;
      margin-top: 10px;
      font-weight: bold;
      font-style: italic;
      text-align: right;
      color: #f5f5f5;
      text-shadow: 0 0 8px rgba(255,255,255,0.4);
      font-family: 'Montserrat', sans-serif;
    }

    .lap {
      text-align: center;
      font-size: 20px;
      margin-bottom: 8px;
    }

    .flag-box {
      text-align: center;
      margin-bottom: 10px;
      border-radius: 8px;
      overflow: hidden;
    }

    .flag-header {
      font-weight: bold;
      align-content: center;
      padding: 5px;
      height: 50px;
      font-size: 30px;
    }

    .flag-sub {
      font-size: 14px;
      padding: 4px;
      background: rgba(0,0,0,0.6);
    }

    .leaderboard {
      width: 100%;
      border-collapse: collapse;
    }

    .leaderboard th, .leaderboard td {
      padding: 5px;
      text-align: center;
    }

    .leaderboard th {
      background: rgba(255,255,255,0.1);
    }

    .leaderboard tr:nth-child(even) {
      background: rgba(255,255,255,0.05);
    }

    .team-logo {
      height: 25px;
      vertical-align: middle;
    }
     .hidden {
      display: none;
    }
    /* PENALTY BOX */
    #penaltyBox {
      position: fixed;
      top: 150px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #43d0dd;
      padding: 15px 25px;
      border-radius: 10px;
      text-align: center;
      font-size: 1.1rem;
      backdrop-filter: blur(6px);
      animation: fadeIn 0.3s ease;
    }

    /* Flag colors */
    .flag-green .flag-header { background: #00cc00; color: black; }
    .flag-yellow .flag-header { background: #ffcc00; color: black; }
    .flag-red .flag-header { background: #cc0000; color: white; }
    .flag-safety {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffcc00;
      color: black;
      font-weight: bold;
      border-radius: 8px;
      padding: 10px;
      gap: 50px;
      font-size: 25px;
      font-family: 'Impact', Haettenschweiler, Arial Narrow Bold, sans-serif;
      margin-bottom: 10px;
    }

    .flag-safety img { height: 75px; }

    .flag-formation {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 8px;
      text-align: center;
      font-weight: bold;
      color: #ccc;
    }
     #statusBanner {
      position: fixed;
      top: 75px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      padding: 12px 25px;
      font-weight: bold;
      font-size: 1.2rem;
      letter-spacing: 1px;
      text-align: center;
      border-radius: 0;
      box-shadow: none;
      transition: opacity 1s ease, background 0.3s ease;
    }
        #statusLogo {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      margin-right: 15px;
      border-radius: 8px;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
    <div id="statusBanner">
      <div id="image"></div>
      <div id="statusLogo">‚è±</div>
    <div id="statusText">Waiting for start...</div>
  </div>
  <div class="hud">
    <div class="logo-row">
      <img src="/static/logo_samc.png" alt="SAMC">
      <div class="session-label" id="sessionLabel">RACE</div>
    </div>
    <div id="penaltyBox" class="hidden"></div>
    <div class="lap" id="lapDisplay">Lap 1/58</div>

    <!-- FLAG AREA -->
    <div id="flagBox"></div>

    <!-- LEADERBOARD -->
    <table class="leaderboard" id="leaderboardTable">
      <thead>
        <tr>
          <th>Pos</th>
          <th></th>
          <th>Driver</th>
          <th>Gap</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>1</td><td><img src="/static/sonnard.png" class="team-logo"></td><td>LEC</td><td>Leader</td></tr>
        <tr><td>2</td><td><img src="/static/harmony.png" class="team-logo"></td><td>VER</td><td>+1.239</td></tr>
        <tr><td>3</td><td><img src="/static/agro.png" class="team-logo"></td><td>NOR</td><td>+2.502</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const socket = io();
    const flagBox = document.getElementById('flagBox');
    const lapDisplay = document.getElementById('lapDisplay');
    const leaderboardTable = document.getElementById('leaderboardTable').querySelector('tbody');
    const sessionLabel = document.getElementById('sessionLabel');

    // ========== FLAG EVENTS ==========
    socket.on('penalty_update', (data) => {
    const box = document.getElementById('penaltyBox');
    box.innerHTML = `
  <img src="static/SAMF.png" alt="Icon" style="float:left; margin-right:8px; width:100px; height:100px;">
  <b>SAMC STEWARDS</b>: ${data.penalty} FOR #${data.driver} - ${data.reason}`;
    box.classList.remove('hidden');
    setTimeout(() => box.classList.add('hidden'), 7500);
  });

  socket.on('raceControl_update', (data) => {
    const box = document.getElementById('penaltyBox');
    box.innerHTML = `
  <img src="static/SAMF.png" alt="Icon" style="float:left; margin-right:8px; width:100px; height:100px;">
  <b>RACE CONTROL</b>: ${data.driver1} INCIDENT - ${data.reason1} -  ${data.penalty1}`;
    box.classList.remove('hidden');
    setTimeout(() => box.classList.add('hidden'), 5000);
  });



    // ========== FORMATION LAP ==========
    socket.on('formation_lap', () => {
      flagBox.innerHTML = `
        <div class="flag-formation">FORMATION LAP</div><br>
      `;
    });

    let bannerTimeout = null;
    function updateBanner(img, emoji, text, autoHide = false) {
    const image = document.getElementById('image');
    const banner = document.getElementById('statusBanner');
    const logo = document.getElementById('statusLogo');
    const statusText = document.getElementById('statusText');

    image.innerHTML = img;
    logo.textContent = emoji;
    statusText.innerHTML = text;
    banner.style.opacity = "1";

    if (bannerTimeout) clearTimeout(bannerTimeout);
    if (autoHide) {
      bannerTimeout = setTimeout(() => {
        banner.style.transition = "opacity 1s ease";
        banner.style.opacity = "0";
      }, 5000);
    } else {
      banner.style.opacity = "1";
    }
  }
    socket.on('formation_lap', () => {
    updateBanner("","üèéÔ∏è", "Formation Lap", false);
  });

    socket.on('flag_update', (data) => {
      const type = data.type;
      flagBox.innerHTML = '';

      if (type === 'green') {
        flagBox.innerHTML = `
          <div class="flag-box flag-green">
            <div class="flag-header">GREEN FLAG</div>
            <div class="flag-sub">TRACK CLEAR</div>
          </div>`;
          setTimeout(() => { flagBox.innerHTML = ''; }, 3000);
        // Menghilangkan banner setelah 3 detik 
        updateBanner("","üü¢", "Green Flag - Track Clear", true);
      }

      else if (type === 'yellow') {
        const sector = data.sector ? `SECTOR ${data.sector} - ` : '';
        flagBox.innerHTML = `
          <div class="flag-box flag-yellow">
            <div class="flag-header">YELLOW FLAG</div>
            <div class="flag-sub">${sector}TRACK HAZARD</div>
          </div>`;
      }

      else if (type === 'red') {
        flagBox.innerHTML = `
          <div class="flag-box flag-red">
            <div class="flag-header">RED FLAG</div>
            <div class="flag-sub">SESSION SUSPENDED</div>
          </div>`;
      }

      else if (type === 'safety') {
        flagBox.innerHTML = `
          <div class="flag-safety">
            <img src="/static/SAMFB.png" alt="SC">
            <span>SAFETY<br>CAR</span>
          </div>`;
      }

      else if (type === 'safety_end') {
        flagBox.innerHTML = `
          <div class="flag-safety">
            <img src="/static/SAMFB.png" alt="SC">
            <span>SAFETY<br>CAR<br>ENDING</span>
          </div>`;
      }
    });

    // ========== LAP UPDATE ==========
    socket.on('lap_update', (data) => {
      lapDisplay.textContent = `Lap ${data.current}/${data.total}`;
    });

    // ========== SESSION UPDATE ==========
    socket.on('session_update', (data) => {
      sessionLabel.textContent = data.session;
    });

    // ========== LEADERBOARD ==========
    socket.on('leaderboard_update', (data) => {
      leaderboardTable.innerHTML = '';
      data.forEach(row => {
        leaderboardTable.innerHTML += `
          <tr>
            <td>${row.pos}</td>
            <td><img src="${row.team_logo}" class="team-logo"></td>
            <td>${row.name}</td>
            <td>${row.gap}</td>
          </tr>`;
      });
    });
  </script>
</body>
</html>
