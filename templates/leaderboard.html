<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Race Leaderboard</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: transparent;
      color: #fff;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    /* STATUS BANNER */
    #statusBanner {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      padding: 12px 25px;
      font-weight: bold;
      font-size: 1.2rem;
      letter-spacing: 1px;
      text-align: center;
      border-radius: 0;
      box-shadow: none;
      transition: opacity 1s ease, background 0.3s ease;
    }

    #statusLogo {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      margin-right: 15px;
      border-radius: 8px;
      font-size: 1.5rem;
    }

    /* PENALTY BOX */
    #penaltyBox {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff4747;
      padding: 15px 25px;
      border-radius: 10px;
      text-align: center;
      font-size: 1.1rem;
      backdrop-filter: blur(6px);
      animation: fadeIn 0.3s ease;
    }

    .hidden {
      display: none;
    }

    #lights {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 100px;
      gap: 20px;
    }

    .light {
      width: 60px;
      height: 60px;
      background-color: #222;
      border-radius: 50%;
      box-shadow: inset 0 0 15px #000;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    .light.on {
      background-color: red;
      box-shadow: 0 0 20px 5px red;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
  <div id="statusBanner">
    <div id="statusLogo">‚è±</div>
    <div id="statusText">Waiting for start...</div>
  </div>

  <div id="penaltyBox" class="hidden"></div>
  <div id="lights"></div>

  <script>
  const socket = io();
  let lightsOn = false;
  let bannerTimeout = null;

  socket.on('lights_start', () => {
    startLightAnimation();
    lightsOn = true;
  });

  socket.on('race_started', () => {
    lightsOn = false;
    document.getElementById('lights').innerHTML = "";
    updateBanner("üèÅ", "Race Started!", true);
  });

  socket.on('formation_lap', () => {
    updateBanner("üèéÔ∏è", "Formation Lap in Progress", true);
  });

  socket.on('flag_update', (data) => {
    const type = data.type;
    if (type === 'yellow')
      updateBanner("‚ö†Ô∏è", `Yellow Flag Sector ${data.sector || ''}<br><span style="font-size:12px;">TRACK HAZARD</span>`);
    else if (type === 'safety')
      updateBanner("üöó", "Safety Car Deployed");
    else if (type === 'safety_end')
      updateBanner("üü¢", `SAFETY CAR IN THIS LAP<br><span style="font-size:12px;">MAINTAIN SPEED</span>`, true);
    else if (type === 'red')
      updateBanner("üî¥", "Red Flag");
    else if (type === 'green')
      updateBanner("üü¢", "Green Flag - Race Resumed", true);
  });

  socket.on('penalty_update', (data) => {
    const box = document.getElementById('penaltyBox');
    box.innerHTML = `<b>Penalty</b><br>#${data.driver} ${data.penalty}<br>Reason: ${data.reason}`;
    box.classList.remove('hidden');
    setTimeout(() => box.classList.add('hidden'), 5000);
  });

  function updateBanner(emoji, text, autoHide = false) {
    const banner = document.getElementById('statusBanner');
    const logo = document.getElementById('statusLogo');
    const statusText = document.getElementById('statusText');

    logo.textContent = emoji;
    statusText.innerHTML = text;
    banner.style.opacity = "1";

    if (bannerTimeout) clearTimeout(bannerTimeout);
    if (autoHide) {
      bannerTimeout = setTimeout(() => {
        banner.style.transition = "opacity 1s ease";
        banner.style.opacity = "0";
      }, 5000);
    } else {
      banner.style.opacity = "1";
    }
  }

  function startLightAnimation() {
    const lights = document.getElementById('lights');
    lights.innerHTML = '';
    for (let i = 0; i < 5; i++) {
      const light = document.createElement('div');
      light.className = 'light';
      lights.appendChild(light);
      setTimeout(() => light.classList.add('on'), i * 600);
    }
    updateBanner("üî¥", "Starting Sequence...");
  }
  </script>

</body>
</html>
