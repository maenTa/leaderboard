<!DOCTYPE html>
<html>
<head>
  <title>Race Control Panel</title>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body { font-family: Segoe UI, sans-serif; background: #111; color: white; padding: 20px; 
    -webkit-user-select: none; /* Safari */
    -moz-user-select: none;    /* Firefox */
    -ms-user-select: none;     /* Internet Explorer/Edge */
    user-select: none;         /* Standar modern */
    }
    button {
      margin: 5px; padding: 10px 15px; border: none; border-radius: 8px;
      background: #444; color: white; cursor: pointer; transition: 0.2s;
    }
    button:hover { background: #666; }
    button.active { background: #e0a800; }
  </style>
</head>
<body>
  <!-- PASSWORD MODAL -->
<div id="passwordModal" style="
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center;
  z-index: 9999;
">
  <div style="background: #222; padding: 30px; border-radius: 10px; text-align: center; width: 300px;">
    <h3>üîí Enter Admin Password</h3>
    <input type="password" id="passwordInput" placeholder="Password" style="
      width: 90%; padding: 10px; margin-top: 15px; border-radius: 5px; border: none; outline: none;
    ">
    <br>
    <button onclick="checkPassword()" style="
      margin-top: 15px; padding: 10px 20px; border: none; border-radius: 5px;
      background: #e0a800; color: black; font-weight: bold; cursor: pointer;
    ">Login</button>
    <p id="errorMsg" style="color: #ff6666; margin-top: 10px; display: none;">Wrong password!</p>
  </div>
</div>

  <h2>üèÅ Race Control Panel</h2>
  <button onclick="socket.emit('start_formation_lap')">Formation Lap</button>
  <button onclick="startLights()">Start Lights</button>
  <button onclick="confirmStart()">Confirm Start</button>
  <hr>

  <button onclick="sendFlag('yellow', 1)">Yellow S1</button>
  <button onclick="sendFlag('yellow', 2)">Yellow S2</button>
  <button onclick="sendFlag('yellow', 3)">Yellow S3</button>
  <button id="safetyBtn" onclick="toggleSafety()">Safety Car</button>
  <button onclick="sendFlag('red')">Red Flag</button>
  <button onclick="sendFlag('green')">Green Flag</button>
  
  <hr>
  <h3>Session Mode</h3>
  <button onclick="changeSession('FP1')">FP1</button>
  <button onclick="changeSession('FP2')">FP2</button>
  <button onclick="changeSession('FP3')">FP3</button>
  <button onclick="changeSession('Qualify')">Qualifying</button>
  <button onclick="changeSession('RACE')">RACE</button>

  <script>
    function changeSession(mode) {
      socket.emit('session_change', { session: mode });
    }
  </script>

  <hr>
  <h3>Penalty</h3>
  <form onsubmit="sendPenalty(event)">
    Driver: <input type="text" id="driver"><br>
    Reason: <input type="text" id="reason"><br>
    Penalty: <input type="text" id="penalty"><br>
    <button type="submit">Send Penalty</button>
  </form>

  <hr>
  <h3>RACE CONTROL</h3>
  <form onsubmit="sendraceControl(event)">
    Driver1: <input type="text" id="driver1"><br>
    Reason1: <input type="text" id="reason1"><br>
    Penalty1: <input type="text" id="penalty1"><br>
    <button type="submit">Send Race Control</button>
  </form>

  <script>
    const socket = io();
    let safetyActive = false;

    function startLights() {
      socket.emit('start_lights');
    }

    function confirmStart() {
      socket.emit('race_start');
    }

    function sendFlag(type, sector=null) {
      socket.emit('flag_event', { type, sector });
    }

    function toggleSafety() {
      safetyActive = !safetyActive;
      const btn = document.getElementById('safetyBtn');
      btn.classList.toggle('active', safetyActive);
      socket.emit('flag_event', { type: 'safety' });
    }

    function sendPenalty(e) {
      e.preventDefault();
      const data = {
        driver: document.getElementById('driver').value,
        reason: document.getElementById('reason').value,
        penalty: document.getElementById('penalty').value
      };
      socket.emit('penalty', data);
    }

    function sendraceControl(e) {
      e.preventDefault();
      const data = {
        driver1: document.getElementById('driver1').value,
        reason1: document.getElementById('reason1').value,
        penalty1: document.getElementById('penalty1').value
      };
      socket.emit('raceControl', data);
    }
  
    async function checkPassword() {
      const password = document.getElementById('passwordInput').value;

      const response = await fetch('/verify-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });

      const result = await response.json();

      if (result.success) {
        document.getElementById('passwordModal').style.display = 'none';
      } else {
        const err = document.getElementById('errorMsg');
        err.style.display = 'block';
        err.textContent = '‚ùå Password salah!';
      }
    }


  </script>
</body>
</html>
